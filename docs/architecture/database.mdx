# Database

This document describes the database architecture.

## Core Data Model Diagram

This diagram illustrates the primary tables and their most important relationships.

<Diagram>{`
graph TD;
    subgraph "User & Session Management"
        A[user_profiles] --> B(chat_sessions);
        A --> F(memories);
    end

    subgraph "Conversation Data"
        B --> C{chat_history};
    end

    subgraph "Memory System"
        F --> G{memory_relationships};
        F --> H{hard_memory_entries};
        F --> I{personality};
    end

    classDef table fill:#2E4053,stroke:#3498DB,stroke-width:2px,color:#fff;
    class A,B,C,F,G,H,I table;
`}</Diagram>

## Key Table Descriptions

- **`user_profiles`**: Extends the built-in `auth.users` table. It stores application-specific user information like `username` and `user_role`. Every authenticated user has a corresponding entry here.

- **`chat_sessions`**: Represents a single conversation. It links to a `user_id` and contains metadata about the chat, such as its `title` and `status`.

- **`chat_history`**: Contains the turn-by-turn log of a conversation. Each row is a single message from either the "user" or the "assistant" (`role` column) and is linked to a `chat_session_id`.

- **`memories`**: This is the heart of Liara's long-term memory. Each row represents a single, semantic piece of information extracted from a conversation.
    - It contains the `content` of the memory, its `importance` score, and other metadata.
    - The crucial `embedding` column stores a vector representation of the content, generated by an AI model. This column is indexed using `pgvector` to enable fast and powerful semantic search.

- **`hard_memory_entries`**: Stores explicit, factual memories that are treated as ground truth. This is distinct from the semantic `memories` table.

- **`personality`**: Stores personality traits and aspects for users. Like memories, these have `embedding` vectors, allowing the system to find relevant personality traits during conversation.

- **`memory_relationships`**: A join table that connects memories to each other, creating a graph-like structure. This allows the system to understand how different pieces of information relate to one another.

This schema enables sophisticated features like recalling past conversations, understanding user preferences, and maintaining a consistent personality over time. 