# Import UI Architecture v0.15.6

This document provides detailed technical documentation for the redesigned import pipeline UI architecture, component system, and implementation details.

## ğŸ—ï¸ System Architecture

### Component Hierarchy

```
ImportPage (Provider)
â”œâ”€â”€ ImportPageContent (Consumer)
â”‚   â”œâ”€â”€ CompactStep1
â”‚   â”‚   â”œâ”€â”€ FileUpload
â”‚   â”‚   â””â”€â”€ Button (Process)
â”‚   â”œâ”€â”€ CompactStep2  
â”‚   â”‚   â”œâ”€â”€ QuickPresets
â”‚   â”‚   â””â”€â”€ Button (Enrich)
â”‚   â”œâ”€â”€ TokenInfoBlock
â”‚   â”‚   â”œâ”€â”€ Select (Model)
â”‚   â”‚   â””â”€â”€ Cost Display
â”‚   â”œâ”€â”€ CompactStep3
â”‚   â”‚   â”œâ”€â”€ Select (File)
â”‚   â”‚   â””â”€â”€ Buttons (Preview/Load)
â”‚   â”œâ”€â”€ LiveStatusConsole
â”‚   â””â”€â”€ DataPreview
â””â”€â”€ ImportProvider (Context)
```

### State Management

The import system uses a centralized React Context pattern:

```typescript
// ImportContext.tsx
interface ImportContextType {
  // File Processing
  file: File | null;
  preprocessedData: Conversation[];
  
  // Selection State
  includeSelection: Set<string>;
  enrichSelection: Set<string>;
  
  // Configuration
  config: ImportConfig;
  
  // Loading States
  isLoading: boolean;
  currentStage: 'processing' | 'enriching' | 'loading';
  
  // Actions
  handleProcess: () => void;
  handleEnrichStream: (conversations: Conversation[]) => void;
  handleLoadFromFile: () => void;
}
```

## ğŸ¨ CSS Architecture

### Grid System

The layout uses a custom CSS Grid system for precise control:

```css
/* ImportPage.css */
.import-page-grid {
  display: grid;
  grid-template-columns: 1fr 200px;
  gap: 12px;
  height: fit-content;
}

.import-left-column {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.import-right-column {
  display: flex;
  flex-direction: column;
  gap: 8px;
}
```

### Component-Specific Layouts

#### Step 1: File Processing
```css
.step1-content {
  display: grid;
  grid-template-rows: 1fr auto;
  gap: 8px;
  height: 100%;
}

.step1-top-row {
  display: grid;
  grid-template-columns: 1fr 120px;
  gap: 8px;
  align-items: stretch;
}

.step1-bottom-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}
```

#### Step 2: Data Enrichment
```css
.step2-content {
  display: grid;
  grid-template-rows: auto 1fr;
  gap: 8px;
  height: 100%;
}

.step2-top-row {
  display: grid;
  grid-template-columns: 1fr 100px;
  gap: 8px;
  align-items: end;
}
```

#### Step 3: Database Loading
```css
.step3-content {
  display: grid;
  grid-template-rows: auto 1fr;
  gap: 8px;
  height: 100%;
}

.step3-top-row {
  display: grid;
  grid-template-columns: 160px 1fr 1fr;
  gap: 4px;
  align-items: end;
}
```

### Responsive Design

```css
@media (max-width: 768px) {
  .import-page-grid {
    grid-template-columns: 1fr;
    gap: 8px;
  }
  
  .import-right-column {
    order: -1;
  }
  
  .step1-top-row,
  .step2-top-row,
  .step3-top-row {
    grid-template-columns: 1fr;
    gap: 8px;
  }
}
```

## ğŸ”§ Component Implementation

### TokenInfoBlock Component

```typescript
// TokenInfoBlock.tsx
interface TokenInfoBlockProps {
  conversations: Array<{ messages: Array<{ content: string }> }>;
}

export const TokenInfoBlock: React.FC<TokenInfoBlockProps> = ({ conversations }) => {
  const [selectedModel, setSelectedModel] = useState('gpt-4-turbo');

  const tokenEstimate = useMemo(() => {
    if (conversations.length === 0) return defaultEstimate;
    return calculateTokensForEnrichment(conversations);
  }, [conversations]);

  const costEstimate = useMemo(() => {
    if (tokenEstimate.totalTokens === 0) return defaultCost;
    return calculateCostForModel(tokenEstimate, selectedModel);
  }, [tokenEstimate, selectedModel]);

  return (
    <div className="space-y-2">
      <ModelSelector value={selectedModel} onChange={setSelectedModel} />
      <StatsGrid estimate={tokenEstimate} />
      <CostBreakdown estimate={costEstimate} />
    </div>
  );
};
```

### QuickPresets Component

```typescript
// QuickPresets.tsx
interface QuickPresetsProps {
  onPresetSelect: (scope: string) => void;
  currentScope: string;
  disabled?: boolean;
}

const presets = [
  { id: 'lines-10', label: 'Quick Test', icon: Zap },
  { id: 'conversations-50', label: 'Standard', icon: Target },
  { id: 'conversations--1', label: 'Full Import', icon: Database },
];

export const QuickPresets: React.FC<QuickPresetsProps> = ({
  onPresetSelect,
  currentScope,
  disabled
}) => {
  return (
    <div className="flex gap-1">
      {presets.map((preset) => (
        <Button
          key={preset.id}
          variant={currentScope === preset.id ? 'default' : 'outline'}
          size="sm"
          onClick={() => onPresetSelect(preset.id)}
          disabled={disabled}
          className="compact-button-small"
        >
          <preset.icon className="w-3 h-3 mr-1" />
          {preset.label}
        </Button>
      ))}
    </div>
  );
};
```

## ğŸ¯ Token Estimation Engine

### Core Calculation Logic

```typescript
// tokenEstimator.ts
export const calculateTokensForEnrichment = (conversations: Conversation[]) => {
  let totalInputTokens = 0;
  let messageCount = 0;

  conversations.forEach(conversation => {
    conversation.messages.forEach(message => {
      const tokens = estimateTokens(message.content);
      totalInputTokens += tokens;
      messageCount++;
    });
  });

  const estimatedOutputTokens = Math.ceil(totalInputTokens * 0.3);
  
  return {
    totalInputTokens,
    estimatedOutputTokens,
    totalTokens: totalInputTokens + estimatedOutputTokens,
    conversationCount: conversations.length,
    messageCount
  };
};

export const calculateCostForModel = (estimate: TokenEstimate, model: string) => {
  const pricing = MODEL_PRICING[model];
  
  const inputCost = (estimate.totalInputTokens / 1000000) * pricing.inputPrice;
  const outputCost = (estimate.estimatedOutputTokens / 1000000) * pricing.outputPrice;
  
  return {
    inputCost,
    outputCost,
    totalCost: inputCost + outputCost,
    estimatedTime: calculateProcessingTime(estimate.messageCount, pricing.speed)
  };
};
```

### Model Pricing Configuration

```typescript
export const MODEL_PRICING = {
  'gpt-4-turbo': {
    name: 'GPT-4 Turbo',
    inputPrice: 10.00,
    outputPrice: 30.00,
    speed: 0.5 // seconds per message
  },
  'gpt-4o': {
    name: 'GPT-4o',
    inputPrice: 5.00,
    outputPrice: 15.00,
    speed: 0.4
  },
  'gpt-4o-mini': {
    name: 'GPT-4o Mini',
    inputPrice: 0.15,
    outputPrice: 0.60,
    speed: 0.2
  },
  'gpt-3.5-turbo': {
    name: 'GPT-3.5 Turbo',
    inputPrice: 0.50,
    outputPrice: 1.50,
    speed: 0.3
  }
};
```

## ğŸ¨ Theme Integration

### Liara Theme System

```typescript
// liara-theme.ts
export const LiaraTheme = {
  background: {
    primary: '#0f172a',    // slate-900
    secondary: '#1e293b',  // slate-800
    tertiary: '#334155',   // slate-700
  },
  text: {
    primary: '#f1f5f9',    // slate-100
    secondary: '#cbd5e1',  // slate-300
    muted: '#94a3b8',      // slate-400
  },
  status: {
    success: '#10b981',    // emerald-500
    warning: '#f59e0b',    // amber-500
    error: '#ef4444',      // red-500
    info: '#3b82f6',       // blue-500
  },
  accent: {
    primary: '#9b87f5',    // purple-400
    secondary: '#38bdf8',  // sky-400
  }
};

export const liaraClasses = {
  bgPrimary: 'bg-slate-900',
  bgSecondary: 'bg-slate-800',
  textPrimary: 'text-slate-100',
  textSecondary: 'text-slate-300',
  textMuted: 'text-slate-400',
  borderDefault: 'border-slate-700',
  // ... more classes
};
```

## ğŸš€ Performance Optimizations

### Memoization Strategy

```typescript
// TokenInfoBlock optimizations
const tokenEstimate = useMemo(() => {
  if (conversations.length === 0) return defaultEstimate;
  return calculateTokensForEnrichment(conversations);
}, [conversations]);

const costEstimate = useMemo(() => {
  if (tokenEstimate.totalTokens === 0) return defaultCost;
  return calculateCostForModel(tokenEstimate, selectedModel);
}, [tokenEstimate, selectedModel]);
```

### Lazy Loading

```typescript
// Conditional rendering for performance
const DataPreview = lazy(() => import('./DataPreview'));

// Only render when data is available
{(preprocessedData.length > 0 || dataToLoad) && (
  <Suspense fallback={<LoadingSpinner />}>
    <DataPreview />
  </Suspense>
)}
```

---

*This architecture documentation provides the technical foundation for understanding and extending the v0.15.6 import pipeline UI system.*
